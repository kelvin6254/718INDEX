<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>影片上傳完整解決方案</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background: #f5f6fa; font-family: 'Microsoft JhengHei', Arial, sans-serif; }
        .solution-card { background: white; border-radius: 12px; padding: 20px; margin: 15px 0; box-shadow: 0 2px 12px rgba(0,0,0,0.06); }
        .code-block { background: #f8f9fa; border-radius: 8px; padding: 15px; margin: 10px 0; font-family: 'Courier New', monospace; }
        .step-number { display: inline-block; width: 30px; height: 30px; background: #2339d6; color: white; border-radius: 50%; text-align: center; line-height: 30px; margin-right: 10px; }
    </style>
</head>
<body>
    <div class="container py-4">
        <h1 class="text-center mb-4">
            <i class="fas fa-video me-2"></i>影片上傳完整解決方案
        </h1>
        
        <div class="solution-card">
            <h3><i class="fas fa-server me-2"></i>第一步：建立後端伺服器</h3>
            <p>使用 Node.js + Express 建立後端API，處理影片上傳和儲存。</p>
            
            <h5>1.1 安裝必要套件</h5>
            <div class="code-block">
npm init -y<br>
npm install express multer aws-sdk mongoose cors dotenv<br>
npm install --save-dev nodemon
            </div>
            
            <h5>1.2 建立伺服器檔案 (server.js)</h5>
            <div class="code-block">
const express = require('express');<br>
const multer = require('multer');<br>
const AWS = require('aws-sdk');<br>
const cors = require('cors');<br>
require('dotenv').config();<br><br>

const app = express();<br>
app.use(cors());<br>
app.use(express.json());<br><br>

// AWS S3 設定<br>
const s3 = new AWS.S3({<br>
  accessKeyId: process.env.AWS_ACCESS_KEY_ID,<br>
  secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY,<br>
  region: process.env.AWS_REGION<br>
});<br><br>

// 影片上傳端點<br>
app.post('/api/upload-video', upload.single('video'), async (req, res) => {<br>
  try {<br>
    const file = req.file;<br>
    const studentId = req.body.studentId;<br>
    const description = req.body.description;<br><br>
    
    // 上傳到 S3<br>
    const uploadResult = await s3.upload({<br>
      Bucket: process.env.S3_BUCKET_NAME,<br>
      Key: `videos/${studentId}/${Date.now()}-${file.originalname}`,<br>
      Body: file.buffer,<br>
      ContentType: file.mimetype<br>
    }).promise();<br><br>
    
    // 儲存到資料庫<br>
    const videoRecord = new Video({<br>
      studentId,<br>
      description,<br>
      videoUrl: uploadResult.Location,<br>
      fileName: file.originalname,<br>
      fileSize: file.size,<br>
      uploadDate: new Date()<br>
    });<br><br>
    
    await videoRecord.save();<br>
    res.json({ success: true, videoUrl: uploadResult.Location });<br>
  } catch (error) {<br>
    res.status(500).json({ error: error.message });<br>
  }<br>
});<br><br>

app.listen(3000, () => {<br>
  console.log('伺服器運行在 port 3000');<br>
});
            </div>
        </div>
        
        <div class="solution-card">
            <h3><i class="fas fa-database me-2"></i>第二步：資料庫設計</h3>
            <p>使用 MongoDB 儲存影片元資料和用戶資訊。</p>
            
            <h5>2.1 影片模型 (models/Video.js)</h5>
            <div class="code-block">
const mongoose = require('mongoose');<br><br>

const videoSchema = new mongoose.Schema({<br>
  studentId: { type: String, required: true },<br>
  description: { type: String, required: true },<br>
  videoUrl: { type: String, required: true },<br>
  fileName: { type: String, required: true },<br>
  fileSize: { type: Number, required: true },<br>
  uploadDate: { type: Date, default: Date.now },<br>
  status: { type: String, enum: ['pending', 'approved', 'rejected'], default: 'pending' },<br>
  teacherFeedback: [{<br>
    teacherId: String,<br>
    comment: String,<br>
    date: { type: Date, default: Date.now }<br>
  }]<br>
});<br><br>

module.exports = mongoose.model('Video', videoSchema);
            </div>
        </div>
        
        <div class="solution-card">
            <h3><i class="fas fa-cloud me-2"></i>第三步：雲端儲存設定</h3>
            <p>使用 AWS S3 或 Google Cloud Storage 儲存影片檔案。</p>
            
            <h5>3.1 AWS S3 設定</h5>
            <div class="code-block">
// .env 檔案<br>
AWS_ACCESS_KEY_ID=your_access_key<br>
AWS_SECRET_ACCESS_KEY=your_secret_key<br>
AWS_REGION=ap-southeast-1<br>
S3_BUCKET_NAME=your-bucket-name<br>
MONGODB_URI=your_mongodb_connection_string
            </div>
            
            <h5>3.2 影片上傳配置</h5>
            <div class="code-block">
const storage = multer.memoryStorage();<br>
const upload = multer({<br>
  storage: storage,<br>
  limits: {<br>
    fileSize: 100 * 1024 * 1024, // 100MB 限制<br>
  },<br>
  fileFilter: (req, file, cb) => {<br>
    if (file.mimetype.startsWith('video/')) {<br>
      cb(null, true);<br>
    } else {<br>
      cb(new Error('只允許上傳影片檔案'));<br>
    }<br>
  }<br>
});
            </div>
        </div>
        
        <div class="solution-card">
            <h3><i class="fas fa-code me-2"></i>第四步：前端整合</h3>
            <p>修改現有的前端代碼，整合後端API。</p>
            
            <h5>4.1 影片上傳函數</h5>
            <div class="code-block">
async function uploadVideoToServer(studentId, videoFile, description) {<br>
  const formData = new FormData();<br>
  formData.append('video', videoFile);<br>
  formData.append('studentId', studentId);<br>
  formData.append('description', description);<br><br>
  
  try {<br>
    const response = await fetch('http://localhost:3000/api/upload-video', {<br>
      method: 'POST',<br>
      body: formData<br>
    });<br><br>
    const result = await response.json();<br>
    if (result.success) {<br>
      return result.videoUrl;<br>
    } else {<br>
      throw new Error(result.error);<br>
    }<br>
  } catch (error) {<br>
    console.error('上傳失敗:', error);<br>
    throw error;<br>
  }<br>
}
            </div>
            
            <h5>4.2 修改現有上傳功能</h5>
            <div class="code-block">
// 在 student-zone.html 中修改上傳函數<br>
uploadForm.onsubmit = async function(e) {<br>
  e.preventDefault();<br>
  const fileInput = document.getElementById('selfStudyVideo');<br>
  const desc = document.getElementById('selfStudyDesc').value;<br>
  const file = fileInput.files[0];<br><br>
  
  if (!file) {<br>
    showAlert('請選擇影片檔案', 'danger');<br>
    return;<br>
  }<br><br>
  
  // 顯示上傳中狀態<br>
  showAlert('正在上傳影片，請稍候...', 'info');<br><br>
  
  try {<br>
    // 上傳到伺服器<br>
    const videoUrl = await uploadVideoToServer(id, file, desc);<br><br>
    // 儲存到本地（作為備份）<br>
    saveSelfStudyVideo(id, videoUrl, desc, new Date().toISOString().slice(0,10));<br><br>
    showAlert('影片上傳成功！', 'success');<br>
    uploadForm.reset();<br>
    renderVideoFeedbackSection(id);<br>
  } catch (error) {<br>
    showAlert('上傳失敗：' + error.message, 'danger');<br>
  }<br>
};
            </div>
        </div>
        
        <div class="solution-card">
            <h3><i class="fas fa-eye me-2"></i>第五步：老師瀏覽功能</h3>
            <p>建立老師專用的影片瀏覽和管理介面。</p>
            
            <h5>5.1 影片列表API</h5>
            <div class="code-block">
// 取得所有影片<br>
app.get('/api/videos', async (req, res) => {<br>
  try {<br>
    const videos = await Video.find().sort({ uploadDate: -1 });<br>
    res.json(videos);<br>
  } catch (error) {<br>
    res.status(500).json({ error: error.message });<br>
  }<br>
});<br><br>

// 取得特定學生的影片<br>
app.get('/api/videos/:studentId', async (req, res) => {<br>
  try {<br>
    const videos = await Video.find({ studentId: req.params.studentId });<br>
    res.json(videos);<br>
  } catch (error) {<br>
    res.status(500).json({ error: error.message });<br>
  }<br>
});
            </div>
            
            <h5>5.2 老師管理介面</h5>
            <div class="code-block">
// 老師審核影片<br>
app.post('/api/videos/:videoId/review', async (req, res) => {<br>
  try {<br>
    const { status, comment } = req.body;<br>
    const video = await Video.findById(req.params.videoId);<br><br>
    if (status === 'approved' || status === 'rejected') {<br>
      video.status = status;<br>
      if (comment) {<br>
        video.teacherFeedback.push({<br>
          teacherId: req.body.teacherId,<br>
          comment: comment<br>
        });<br>
      }<br>
      await video.save();<br>
      res.json({ success: true });<br>
    } else {<br>
      res.status(400).json({ error: '無效的狀態' });<br>
    }<br>
  } catch (error) {<br>
    res.status(500).json({ error: error.message });<br>
  }<br>
});
            </div>
        </div>
        
        <div class="solution-card">
            <h3><i class="fas fa-shield-alt me-2"></i>第六步：安全措施</h3>
            <p>確保影片上傳和儲存的安全性。</p>
            
            <ul>
                <li><strong>檔案驗證：</strong>檢查檔案類型和大小</li>
                <li><strong>身份驗證：</strong>確保只有授權用戶可以上傳</li>
                <li><strong>內容審核：</strong>防止不當內容上傳</li>
                <li><strong>資料加密：</strong>保護用戶隱私</li>
                <li><strong>備份機制：</strong>確保資料安全</li>
            </ul>
        </div>
        
        <div class="alert alert-info">
            <h5><i class="fas fa-lightbulb me-2"></i>部署建議</h5>
            <div class="row">
                <div class="col-md-6">
                    <strong>雲端平台選擇：</strong>
                    <ul>
                        <li>AWS EC2 + S3</li>
                        <li>Google Cloud Platform</li>
                        <li>Microsoft Azure</li>
                        <li>Heroku（簡單部署）</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <strong>成本估算：</strong>
                    <ul>
                        <li>伺服器：$20-50/月</li>
                        <li>資料庫：$10-30/月</li>
                        <li>影片儲存：$5-20/月</li>
                        <li>CDN：$10-30/月</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="text-center mt-4">
            <a href="index.html" class="btn btn-primary btn-lg me-3">
                <i class="fas fa-home me-2"></i>返回首頁
            </a>
            <a href="deployment-guide.html" class="btn btn-success btn-lg">
                <i class="fas fa-rocket me-2"></i>部署指南
            </a>
        </div>
    </div>
</body>
</html> 