<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>健康專欄 - 學校跳繩平台</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 0;
            color: #333;
        }
        
        .navbar {
            background-color: #2563eb !important;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 15px 0;
        }
        
        .navbar-brand {
            color: white !important;
            font-weight: bold;
            font-size: 1.5rem;
        }
        
        .navbar-nav .nav-link {
            color: white !important;
            font-weight: 500;
            margin: 0 10px;
            padding: 8px 15px !important;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        
        .navbar-nav .nav-link:hover {
            background-color: #f97316;
            color: white !important;
        }
        
        .page-header {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 60px 0;
            text-align: center;
        }
        
        .page-title {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 20px;
        }
        
        .page-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .content-section {
            padding: 40px 0;
            background-color: white;
        }
        
        .section-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #10b981;
        }
        
        .section-header h2 {
            color: #059669;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .video-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .video-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }
        
        .video-container {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 56.25%;
            margin-bottom: 15px;
        }
        
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 8px;
        }
        
        .video-info {
            margin-top: 15px;
        }
        
        .video-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #059669;
            margin-bottom: 8px;
        }
        
        .video-description {
            color: #666;
            margin-bottom: 10px;
        }
        
        .video-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            color: #888;
        }
        
        .btn-custom {
            background-color: #10b981;
            border: none;
            color: white;
            padding: 12px 25px;
            border-radius: 5px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-custom:hover {
            background-color: #059669;
            color: white;
            transform: translateY(-2px);
        }
        
        .form-container {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .form-container h3 {
            color: #059669;
            border-bottom: 2px solid #10b981;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        .form-control {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            transition: border-color 0.3s ease;
        }
        
        .form-control:focus {
            border-color: #10b981;
            box-shadow: 0 0 0 0.2rem rgba(16, 185, 129, 0.25);
        }
        
        .form-label {
            font-weight: 500;
            color: #059669;
            margin-bottom: 8px;
        }
        
        .category-badge {
            background-color: #10b981;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .filter-section {
            background-color: #f0fdf4;
            padding: 20px 0;
            margin-bottom: 30px;
        }
        
        .filter-btn {
            margin: 5px;
            border-radius: 20px;
            padding: 8px 20px;
            border: 2px solid #10b981;
            background: white;
            color: #10b981;
            transition: all 0.3s ease;
        }
        
        .filter-btn.active,
        .filter-btn:hover {
            background: #10b981;
            color: white;
        }
        
        .alert-custom {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            min-width: 300px;
            border-radius: 5px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        
        .health-tips {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            border-left: 4px solid #10b981;
        }
        
        .health-tips h4 {
            color: #059669;
            margin-bottom: 15px;
        }
        
        .health-tips ul {
            margin-bottom: 0;
        }
        
        .health-tips li {
            margin-bottom: 8px;
            color: #374151;
        }
    </style>
</head>
<body>
    <!-- 導航欄 -->
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container">
            <a class="navbar-brand fw-bold" href="index.html">
                <i class="fas fa-school me-2"></i>基督教中國佈道會聖道學校
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">
                            <i class="fas fa-home me-1"></i>首頁
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="holyjumpvibe.html">
                            <i class="fas fa-book-open me-1"></i>繩刊
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="skill-teaching.html">
                            <i class="fas fa-dumbbell me-1"></i>技巧教學
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- 頁面標題 -->
    <div class="page-header">
        <div class="container">
            <h1 class="page-title">
                <i class="fas fa-heart me-3"></i>健康專欄
            </h1>
            <p class="page-subtitle">跳繩運動的健康益處與營養建議，幫助學生建立正確的運動觀念</p>
        </div>
    </div>

    <!-- 篩選區域 -->
    <div class="filter-section">
        <div class="container">
            <h4 class="text-center mb-4">
                <i class="fas fa-filter me-2"></i>篩選健康主題
            </h4>
            <div class="text-center">
                <button class="btn filter-btn active" data-filter="all">全部主題</button>
                <button class="btn filter-btn" data-filter="nutrition">營養建議</button>
                <button class="btn filter-btn" data-filter="fitness">健身知識</button>
                <button class="btn filter-btn" data-filter="injury">傷害預防</button>
                <button class="btn filter-btn" data-filter="mental">心理健康</button>
            </div>
        </div>
    </div>

    <!-- 主要內容 -->
    <div class="content-section">
        <div class="container">
            <!-- 健康小貼士 -->
            <div class="health-tips">
                <h4><i class="fas fa-lightbulb me-2"></i>跳繩運動健康小貼士</h4>
                <ul>
                    <li><strong>熱身運動：</strong>跳繩前務必進行5-10分鐘的熱身運動，包括關節活動和輕度有氧運動</li>
                    <li><strong>正確姿勢：</strong>保持身體挺直，手臂自然擺動，避免過度彎腰或駝背</li>
                    <li><strong>循序漸進：</strong>從基礎動作開始，逐步增加難度和強度</li>
                    <li><strong>適度休息：</strong>每15-20分鐘休息2-3分鐘，避免過度疲勞</li>
                    <li><strong>水分補充：</strong>運動前後適量補充水分，保持身體水分平衡</li>
                </ul>
            </div>

            <!-- 老師上傳區域 -->
            <div class="form-container" id="teacherUploadSection" style="display: none;">
                <h3><i class="fas fa-upload me-2"></i>上傳健康影片</h3>
                <form id="videoUploadForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="videoTitle" class="form-label">影片標題</label>
                                <input type="text" class="form-control" id="videoTitle" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="videoCategory" class="form-label">健康主題</label>
                                <select class="form-control" id="videoCategory" required>
                                    <option value="">請選擇主題</option>
                                    <option value="nutrition">營養建議</option>
                                    <option value="fitness">健身知識</option>
                                    <option value="injury">傷害預防</option>
                                    <option value="mental">心理健康</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="videoUrl" class="form-label">YouTube 影片連結</label>
                        <input type="url" class="form-control" id="videoUrl" placeholder="https://www.youtube.com/watch?v=..." required>
                    </div>
                    <div class="mb-3">
                        <label for="videoDescription" class="form-label">影片描述</label>
                        <textarea class="form-control" id="videoDescription" rows="3" placeholder="請描述這個健康主題的重點和實用建議..."></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="teacherName" class="form-label">上傳老師</label>
                        <input type="text" class="form-control" id="teacherName" required>
                    </div>
                    <button type="submit" class="btn btn-custom">
                        <i class="fas fa-upload me-2"></i>上傳影片
                    </button>
                    <button type="button" class="btn btn-secondary ms-2" onclick="hideTeacherUpload()">
                        <i class="fas fa-times me-2"></i>取消
                    </button>
                </form>
            </div>

            <!-- 老師控制按鈕 -->
            <div class="text-center mb-4">
                <button class="btn btn-custom" onclick="showTeacherUpload()" id="showUploadBtn">
                    <i class="fas fa-plus me-2"></i>新增健康影片
                </button>
            </div>

            <!-- 影片列表 -->
            <div id="videoList">
                <!-- 影片卡片將通過 JavaScript 動態生成 -->
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 全局變量
        let videos = JSON.parse(localStorage.getItem('healthVideos') || '[]');
        let currentFilter = 'all';
        let isTeacherLoggedIn = false;

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            checkTeacherLogin();
            renderVideos();
            setupFilters();
        });

        // 檢查老師登入狀態
        function checkTeacherLogin() {
            const savedRole = localStorage.getItem('userRole');
            const teacherLogin = localStorage.getItem('isTeacherLoggedIn');
            
            if (savedRole === 'teacher' && teacherLogin === 'true') {
                isTeacherLoggedIn = true;
                document.getElementById('showUploadBtn').style.display = 'inline-block';
            } else {
                document.getElementById('showUploadBtn').style.display = 'none';
            }
        }

        // 顯示老師上傳區域
        function showTeacherUpload() {
            if (!isTeacherLoggedIn) {
                showAlert('請先以老師身份登入！', 'warning');
                return;
            }
            document.getElementById('teacherUploadSection').style.display = 'block';
            document.getElementById('showUploadBtn').style.display = 'none';
        }

        // 隱藏老師上傳區域
        function hideTeacherUpload() {
            document.getElementById('teacherUploadSection').style.display = 'none';
            document.getElementById('showUploadBtn').style.display = 'inline-block';
            document.getElementById('videoUploadForm').reset();
        }

        // 設置篩選功能
        function setupFilters() {
            const filterBtns = document.querySelectorAll('.filter-btn');
            filterBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    filterBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentFilter = this.getAttribute('data-filter');
                    renderVideos();
                });
            });
        }

        // 渲染影片列表
        function renderVideos() {
            const videoList = document.getElementById('videoList');
            let html = '';

            const filteredVideos = currentFilter === 'all' 
                ? videos 
                : videos.filter(video => video.category === currentFilter);

            if (filteredVideos.length === 0) {
                html = `
                    <div class="text-center py-5">
                        <i class="fas fa-heart text-muted" style="font-size: 3rem;"></i>
                        <h5 class="text-muted mt-3">暫無健康影片</h5>
                        <p class="text-muted">老師可以上傳 YouTube 影片來豐富健康專欄內容</p>
                    </div>
                `;
            } else {
                filteredVideos.forEach((video, index) => {
                    const videoId = extractYouTubeId(video.url);
                    const embedUrl = `https://www.youtube.com/embed/${videoId}`;
                    
                    html += `
                        <div class="video-card" data-category="${video.category}">
                            <div class="video-container">
                                <iframe src="${embedUrl}" 
                                        title="${video.title}" 
                                        frameborder="0" 
                                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                        allowfullscreen>
                                </iframe>
                            </div>
                            <div class="video-info">
                                <div class="video-title">${video.title}</div>
                                <div class="video-description">${video.description}</div>
                                <div class="video-meta">
                                    <div>
                                        <span class="category-badge">${getCategoryName(video.category)}</span>
                                        <span class="ms-2">上傳者：${video.teacherName}</span>
                                    </div>
                                    <div>
                                        <small>${new Date(video.uploadDate).toLocaleDateString()}</small>
                                        ${isTeacherLoggedIn ? `
                                            <button class="btn btn-sm btn-danger ms-2" onclick="deleteVideo(${index})">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        ` : ''}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
            }

            videoList.innerHTML = html;
        }

        // 提取 YouTube 影片 ID
        function extractYouTubeId(url) {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }

        // 獲取分類名稱
        function getCategoryName(category) {
            const categories = {
                'nutrition': '營養建議',
                'fitness': '健身知識',
                'injury': '傷害預防',
                'mental': '心理健康'
            };
            return categories[category] || category;
        }

        // 刪除影片
        function deleteVideo(index) {
            if (!isTeacherLoggedIn) {
                showAlert('只有老師可以刪除影片！', 'warning');
                return;
            }

            if (confirm('確定要刪除這個健康影片嗎？')) {
                videos.splice(index, 1);
                localStorage.setItem('healthVideos', JSON.stringify(videos));
                renderVideos();
                showAlert('影片已成功刪除！', 'success');
            }
        }

        // 表單提交處理
        document.getElementById('videoUploadForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!isTeacherLoggedIn) {
                showAlert('只有老師可以上傳影片！', 'warning');
                return;
            }

            const title = document.getElementById('videoTitle').value;
            const category = document.getElementById('videoCategory').value;
            const url = document.getElementById('videoUrl').value;
            const description = document.getElementById('videoDescription').value;
            const teacherName = document.getElementById('teacherName').value;

            if (!title || !category || !url || !teacherName) {
                showAlert('請填寫所有必要欄位！', 'danger');
                return;
            }

            // 驗證 YouTube URL
            if (!extractYouTubeId(url)) {
                showAlert('請輸入有效的 YouTube 影片連結！', 'danger');
                return;
            }

            const newVideo = {
                title: title,
                category: category,
                url: url,
                description: description,
                teacherName: teacherName,
                uploadDate: new Date().toISOString()
            };

            videos.push(newVideo);
            localStorage.setItem('healthVideos', JSON.stringify(videos));

            hideTeacherUpload();
            renderVideos();
            showAlert('健康影片已成功上傳！', 'success');
        });

        // 顯示警告訊息
        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show alert-custom`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.parentNode.removeChild(alertDiv);
                }
            }, 3000);
        }
    </script>
</body>
</html>
